<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Converte planilha para JSON para filtrar linhas em branco
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filtra linhas em branco (linhas onde todas as células estão vazias, nulas ou indefinidas)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heurística para encontrar a linha do cabeçalho ignorando linhas com menos células preenchidas que a próxima linha
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Alternativa
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Converte JSON filtrado de volta para CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Cria uma nova planilha a partir do array de arrays filtrado
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="theme-color" content="#f5f5f5"/>
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <meta name="msapplication-tap-highlight" content="no">
  <title>Clauss Fitness • Treino Semanal</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">
  <style>
    /* Conteúdo de login.css */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Mulish:wght@200;300;400;500;600;700;900&family=Public+Sans:wght@100;200;300;400;500;600;700;800;900&display=swap');
    @import url("https://fonts.cdnfonts.com/css/mona-sans");

    :root {
      --bg: #b2b2b2;
      --container-bg: #faf7f7;
      --card-bg: #ffffff;
      --text: #333333;
      --muted: #999999;
      --accent: #FF0000;
      --input-bg: #fff;
      --input-border: #ccc;
      --shadow: 0 8px 24px rgba(0,0,0,0.12);
      --week-day-active-bg: #eee; /* Default para light mode */
      --modal-bg: white;
      --modal-border: #ddd;
      --calendar-day-bg: #f0f0f0;
      --calendar-day-hover-bg: #e0e0e0;
      --calendar-day-completed-bg: var(--check); /* Cor de fundo não usada mais para dia completo */
      --calendar-day-completed-text: var(--text); /* Texto volta ao normal */
      --calendar-header-text: var(--text);
      --calendar-inactive-day: #ccc;
      --check: #32C671; /* Adicionado para consistência */
      --progress-circle-bg: #e0e0e0;
      --progress-circle-fg: var(--accent);
      --completed-dot-color: var(--check);
      /* Cores para o novo ícone */
      --clock-orange: #F14E42;
      --clock-orange-dark: #c13e35; /* darken($orange, 15%) */
      --clock-orange-darker: #8c2d26; /* darken($orange, 30%) */
      --clock-inner-bg: #f0f0f0;
      --clock-inner-shadow: #999;
      --clock-date-color: #333; /* Cor do número */
      --dashboard-bg: var(--card-bg);
      --dashboard-text: var(--text);
      --dashboard-muted: var(--muted);
      --dashboard-bar-bg: #e0e0e0;
      --dashboard-bar-fill: #ffd700; /* Amarelo como na imagem */
      --header-height: 220px; /* Valor inicial fallback, será sobrescrito por JS */
      --header-top-spacing: 40px; /* Espaçamento inicial do topo do header */
      --day-btn-inactive-bg: #e9e9e9; /* Cor de fundo para botões inativos */
      --day-btn-inactive-text: #a0a0a0; /* Cor de texto para botões inativos */
    }

    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes a-text-scroll {
      0% { transform: translate3d(-100%, 0, 0); }
      100% { transform: translate3d(0%, 0, 0); }
    }

    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      /* justify-content: center; */ /* Removido para permitir scroll */
      min-height: 100vh; /* Garante altura mínima */
      height: auto; /* Permite crescer */
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      position: relative;
      overflow-x: hidden; /* Previne scroll horizontal geral */
      color: #f5f5f5;
      font-family: 'Public Sans', sans-serif;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, #171717, #7e1b18);
      background-size: 100% 100%;
      animation: gradientAnimation 15s infinite;
      z-index: 1;
    }

    .background-text {
      position: absolute;
      top: 10%;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: top;
      justify-content: center;
      z-index: 2;
      pointer-events: none;
    }

    .background-text h2 {
      white-space: nowrap;
      font-size: 3em;
      font-weight: 800;
      opacity: 0.7;
      letter-spacing: 0em;
      animation: a-text-scroll 7s linear infinite;
    }

    .login {
      position: absolute;
      top: 19%;
      left: 0;
      right: 0;
      margin: auto;
      width: 320px;
      height: 400px;
      border-radius: 16px;
      background: #191919aa;
      background: linear-gradient(180deg, #292929aa 0%, #191919cc 50%);
      backdrop-filter: blur(4px);
      box-shadow: inset 0 2px 2px 0 #e7c4a088, inset 0 -2px 2px 0 #0003;
      color: #ccc;
      text-shadow: 1px 1px 3px #333a;
      padding: 24px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      z-index: 10;
    }

    .login h1 {
      font-family: "Mona-Sans", sans-serif;
      font-size: 1.6em;
      color: #e7c4a0; /* Cor específica para o modo light */
      margin: 0;
      text-align: left;
    }

    body.dark-mode .login h1 {
      color: var(--accent);
    }

    .login p {
      font-size: 0.9em;
      font-weight: 500;
      color: #aaa;
      margin: 8px 0 24px 0;
    }

    .login input {
      width: 100%;
      background: #ffffff1a;
      border: 1px solid #ffffff33;
      border-radius: 8px;
      padding: 12px;
      color: #fff;
      font-family: "Mona-Sans", sans-serif;
      font-size: 0.9em;
      margin-bottom: 16px;
    }

    .login input:focus {
      outline: none;
      border-color: #e7c4a0;
      box-shadow: 0 0 0 2px #e7c4a044;
    }

    .login button {
      width: fit-content;
      border-radius: 100px;
      padding: 10px 36px;
      margin-top: 12px;
      background: #fff2;
      border: none;
      color: #fff;
      font-family: "Mona-Sans", sans-serif;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 0 0 1px #fff3, inset 120px 0 100px -100px #000c, 0 0 0 0 #fff1;
      transition: box-shadow 0.4s ease-in-out;
      margin: 12px auto 0; /* Adicione esta linha para centralizar */
    }

    .login button:hover {
      box-shadow: 0 0 0 1px #fff3, inset 200px 0px 100px -100px #000a, -4px 0 8px 2px #fff2;
    }

    .login form {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    .accents {
      user-select: none;
      pointer-events: none;
      position: absolute;
      left: 0;
      right: 0;
      top: 20%;
      z-index: 1;
    }

    .acc-card {
      width: 330px;
      height: 400px;
      background: #eee1;
      opacity: 0.8;
      position: absolute;
      left: 0;
      right: 0;
      top: 20%;
      margin: auto;
      border-radius: 16px;
      box-shadow: inset 0 2px 2px 0 #e0c9b266, inset 0 -2px 2px 0 #0004;
      backdrop-filter: blur(4px);
      transition: all 0.1s linear;
      transform-origin: 20% 80%;
    }

    .acc-card:nth-child(1) { animation: wobble 18s ease-in-out infinite; }
    .acc-card:nth-child(2) { animation: wobble 22s ease-in-out -6s infinite reverse; }
    .acc-card:nth-child(3) { animation: wobble 26s ease-in-out -18s infinite; }

    .light {
      --bgref: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg id='Layer_1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 487 487'%3E%3Ccircle cx='243' cy='243.5' r='233' style='fill:none; opacity:.1; stroke:%23aaa; stroke-linecap:round; stroke-miterlimit:10; stroke-width:18px;'/%3E%3Ccircle cx='243.5' cy='243.5' r='243' style='fill:none; stroke:%23111; stroke-linecap:round; stroke-miterlimit:10;'/%3E%3Ccircle cx='243' cy='243.5' r='222' style='fill:none; stroke:%23111; stroke-linecap:round; stroke-miterlimit:10;'/%3E%3Cpath d='m10,243.5C10,114.82,114.32,10.5,243,10.5' style='fill:none; stroke:%23ddd; stroke-linecap:round; stroke-miterlimit:10; stroke-width:18px;'/%3E%3C/svg%3E");
      position: absolute;
      left: 0;
      right: calc(0% + 300px);
      top: 264px;
      margin: auto;
      width: 164px;
      height: 164px;
      z-index: -2;
      background-image: var(--bgref);
      animation: rotate360 22s linear infinite;
    }

    .light::before,
    .light::after {
      content: '';
      display: block;
      width: 100%;
      height: 100%;
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      margin: auto;
      background-image: var(--bgref);
      filter: blur(3px);
      scale: 1.01;
    }

    .light::after { filter: blur(8px); }

    .light.sm {
      width: 100px;
      height: 100px;
      left: calc(0% + 300px);
      right: 0;
      top: 142px;
      bottom: 0;
      animation: rotate360 18s linear -10s infinite;
    }

    .top-light {
      position: absolute;
      left: 0;
      right: 0;
      top: -42px;
      margin: auto;
      width: 284px;
      height: 6px;
      border-radius: 10px;
      background: #fffef9;
      box-shadow: 0 0px 1px 1px #ffc78e,
                 0 1px 2px 1px #ff942977,
                 0 2px 6px 1px #e98b2d77,
                 0 4px 12px 0px #ff9e3d99,
                 0 12px 20px 12px #ff800044;
    }

    @keyframes rotate360 {
      to { rotate: 360deg; }
    }

    @keyframes wobble {
      0% { transform: translateX(10px) translateY(20px) rotate(-3deg) scale(1); }
      20% { transform: translateX(-44px) translateY(-8px) rotate(6deg) scale(1.02); }
      60% { transform: translateX(32px) translateY(18px) rotate(-8deg) scale(1); }
      80% { transform: translateX(-42px) translateY(-22px) rotate(12deg) scale(0.94); }
      100% { transform: translateX(10px) translateY(20px) rotate(-3deg) scale(1); }
    }

    @media screen and (max-height: 600px) {
      .login {
        height: fit-content;
      }
      .acc-card {
        height: 180px !important;
      }
      .login, .accents {
        top: 30%;
      }
      .accents .light {
        top: 124px;
        bottom: 0;
      }
      .accents .light.sm {
        top: 42px;
      }
    }

    .theme-switch {
      align-self: flex-end;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 24px;
    }

    .tgl {
      display: none;
    }

    .tgl + .tgl-btn {
      width: 42px;
      height: 24px;
      background: #ff6347;
      border-radius: 24px;
      position: relative;
      display: inline-block;
      cursor: pointer;
      transition: background 0.3s ease-in-out;
      pointer-events: auto;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      padding: 0;
      border: none;
      outline: none;
      margin: 0;
    }

    .tgl + .tgl-btn:before {
      content: '';
      position: absolute;
      left: 2px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.2s ease-in-out;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .tgl:checked + .tgl-btn {
      background: #505052;
    }

    .tgl:checked + .tgl-btn:before {
      transform: translate(18px, -50%);
    }

    @media (hover: none) {
      .tgl + .tgl-btn {
        min-height: 24px;
      }

      .theme-switch {
        padding: 8px 4px;
      }
    }

    input {
      width: 80%;
      display: block;
      margin: 0 auto 16px auto;
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      outline: none;
      padding: 10px;
      font-size: 0.9rem;
      color: var(--text);
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,.05);
      transition: box-shadow .3s, border-color .3s;
      font-family: 'Poppins', sans-serif;
    }

    input:focus {
      border-color: var(--accent);
      box-shadow: 0 4px 16px rgba(255,0,0,0.10);
    }

    .btn {
      width: 42px;
      height: 24px;
      padding: 0;
      font-size: 0.75rem;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      color: #fff;
      background: #ff6347;
      border: none;
      border-radius: 24px;
      box-shadow: 0 2px 6px rgba(0,0,0,.08);
      cursor: pointer;
      transition: background 0.3s ease-in-out;
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn:hover {
      background: #32c671;
    }

    body.dark-mode {
      --bg: rgba(0, 0, 0, 0.184);
      --container-bg: #232323;
      --card-bg: #1b1b1b;
      --text: #f5f5f5;
      --muted: #8b8b8b;
      --accent: #FF5252;
      --input-bg: #181818;
      --input-border: #918f8f;
      --shadow: 0 8px 24px rgba(0, 0, 0, 0.32);
      background: linear-gradient(to bottom, var(--bg) 0%, color-mix(in srgb, var(--bg) 90%, black) 100%);
      /* Dark mode calendar colors */
      --week-day-active-bg: #333;
      --modal-bg: #2a2a2a;
      --modal-border: #444;
      --calendar-day-bg: #383838;
      --calendar-day-hover-bg: #454545;
      --calendar-day-completed-bg: var(--accent);
      --calendar-day-completed-text: #fff;
      --calendar-header-text: #eee;
      --calendar-inactive-day: #555;
      --progress-circle-bg: #555; /* Fundo mais escuro */
      --progress-circle-fg: var(--accent);
      --completed-dot-color: var(--check);
      /* Dark mode para novo ícone */
       --clock-orange: #FF5252; /* Usando accent color */
       --clock-orange-dark: #D43A3A;
       --clock-orange-darker: #A32D2D;
       --clock-inner-bg: #333;
       --clock-inner-shadow: #666;
       --clock-date-color: #f0f0f0;
       --dashboard-bg: var(--card-bg);
       --dashboard-text: var(--text);
       --dashboard-muted: var(--muted);
       --dashboard-bar-bg: #555;
       --dashboard-bar-fill: #ffd700; /* Amarelo como na imagem */
       --day-btn-inactive-bg: #444; /* Cor de fundo para botões inativos (dark) */
       --day-btn-inactive-text: #888; /* Cor de texto para botões inativos (dark) */
    }

    body.dark-mode .login {
      background: var(--container-bg);
      box-shadow: var(--shadow);
    }

    body.dark-mode input {
      background: var(--input-bg);
      color: var(--text);
      border: 1px solid var(--input-border);
    }

    body.dark-mode .btn {
      background: var(--accent);
    }

    body.dark-mode .btn:hover {
      background: #c20000;
    }

    .card {
      position: relative;
      width: 315px;
      border-radius: 1em;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      color: #f9f9f9;
      display: flex;
      flex-direction: column;
      background: linear-gradient(45deg, #171717, #7e1b18);
      background-size: 200% 200%;
      animation: gradientAnimation 15s infinite;
    }

    .card-header {
      margin: 0px 0;
      padding: 20px 20px 0 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-lable-container {
      height: 230px;
      border: 0px solid black;
      margin: 30px 0;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
    }

    .card-lable-container h2 {
      white-space: nowrap;
      pointer-events: none;
      font-size: 14em;
      font-weight: 800;
      flex-shrink: 0;
      padding: 0 20px;
      opacity: 0.35;
      width: max-content;
      display: flex;
      align-items: center;
      transition: opacity 1000ms ease-in-out;
      transform: translateX(0);
      animation: a-text-scroll 35s linear infinite;
    }

    .card:hover .card-lable-container h2 {
      opacity: 0.75;
    }

    .card:hover .shoe-image {
      transform: translate(-5%, -9%) rotate(15deg) scale(1.025);
    }

    .nike-logo-container {
      position: absolute;
      top: 2%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 3;
    }

    .nike-logo {
      width: 40px;
      user-select: none;
    }

    /* Estilos base */
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;800&display=swap");

    :root {
      /* ... outras variáveis ... */
      --header-height: 0px; /* Altura calculada dinamicamente */
      --check: #32C671;
    }

    body {
      /* ... estilos body ... */
      font-family: 'Poppins', sans-serif;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow-x: hidden; margin: 0; padding: 0; overflow-y: auto !important; }

    .header-container {
      position: fixed !important;
      top: var(--header-top-spacing) !important; /* Usa variável para espaçamento */
      left: 50% !important;
      transform: translateX(-50%) !important;
      width: 100%;
      max-width: 400px;
      padding: 8px 16px 8px 16px !important;
      margin: 0 auto;
      z-index: 2000 !important;
      background: var(--container-bg) !important;
      height: auto;
      border-radius: 16px !important;
      overflow: visible !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }

    /* Ajuste para posicionar tasks e dashboard abaixo do header */
    #dashboard, .tasks {
        position: absolute; /* Mantido absolute para controle preciso */
        top: calc(var(--header-height) + var(--header-top-spacing) + 10px); /* Posiciona abaixo do header */
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 400px; /* Mesma largura do header */
        padding-left: 16px;
        padding-right: 16px;
        z-index: 10; /* Mantém abaixo do header */
    }

    .tasks {
      height: auto; /* Altura automática */
      min-height: calc(100vh - var(--header-height) - var(--header-top-spacing) - 20px); /* Altura mínima para preencher */
      padding-top: 10px;
      overflow-y: auto;
      overflow-x: hidden;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      pointer-events: none;
      -webkit-overflow-scrolling: touch;
    }
    .tasks.visible { opacity: 1; visibility: visible; pointer-events: all !important; }
    .tasks-wrapper { width: 100%; position: relative; padding: 12px 0; overflow: hidden; margin: 0 auto; }

    header {
      width: 100%;
      display: flex;
      justify-content: flex-end; /* Alinha controles à direita */
      align-items: center;
      margin: 0;
      padding-top: 0; /* Removido padding extra */
      overflow: visible;
      pointer-events: auto; /* Permite clicar nos controles */
    }
    /* Removido .date */

    .insights {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 16px;
      margin-top: 4px;
      margin-bottom: 8px;
      height: auto;
      min-height: 88px; /* Altura mínima para acomodar conteúdo */
      flex-shrink: 0;
      flex-grow: 0;
      cursor: pointer;
      transition: transform 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
      pointer-events: auto;
      position: relative; /* Para posicionar o botão animado */
    }
    .insights:hover { transform: scale(0.98); }

    /* --- Estilos Novo Ícone Calendário Flip Clock --- */
    .clock-icon-container {
        position: absolute;
        top: 10px; /* Ajuste conforme necessário */
        right: 10px; /* Ajuste conforme necessário */
        width: 60px;  /* Largura aumentada */
        height: 60px; /* Altura aumentada */
        z-index: 2100;
        cursor: pointer;
        font-family: 'Roboto', sans-serif; /* Garante a fonte correta */
    }

    .clock-icon-container .outer {
        background: var(--clock-orange);
        position: relative;
        height: 100%; /* Ocupa container */
        width: 100%; /* Ocupa container */
        border-radius: 10px; /* Raio ajustado */
        box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.3);
        display: flex; /* Para centralizar handle */
        flex-direction: column; /* Empilha handle e inner */
        align-items: center; /* Centraliza handle horizontalmente */
        padding-top: 8%; /* Espaço para o handle */
    }

    .clock-icon-container .handle {
        height: 8px; /* Altura ajustada */
        width: 45%; /* Largura relativa */
        background: var(--clock-orange-dark);
        border-radius: 4px; /* Raio ajustado */
        box-shadow: inset 0px 0px 1px 1px rgba(0, 0, 0, 0.1); /* Sombra mais suave */
        margin-bottom: 5%; /* Espaço abaixo do handle */
    }

    .clock-icon-container .inner {
        background: var(--clock-inner-bg);
        border-radius: 5px;
        position:relative;
        width: 80%; /* Largura relativa */
        height: 65%; /* Altura relativa */
        box-shadow: 0px 1px 2px 1px rgba(0, 0, 0, 0.26);
        overflow: hidden; /* Esconde partes do número que vazam */
    }

    .clock-icon-container .date {
        font-size: 2.2em; /* Tamanho ajustado */
        line-height: 1; /* Para melhor controle vertical */
        display: flex; /* Centraliza com flex */
        justify-content: center;
        align-items: center;
        position: absolute;
        top: 0; right:0; bottom: 0; left: 0;
        color: var(--clock-date-color);
        font-weight: 400; /* Peso da fonte Roboto */
    }

    .clock-icon-container .date1 { /* Metade superior */
        height: 50%; /* Ocupa metade superior */
        overflow: hidden;
        background: #e8e8e8; /* Cor ligeiramente diferente */
        z-index: 10;
        border-radius: 5px 5px 0 0;
        box-shadow: inset 0px 0px 1px 1px rgba(0,0,0, 0.05);
        border-bottom: 1px solid rgba(0,0,0,0.1); /* Linha de dobra */
        align-items: flex-end; /* Alinha na base da metade */
        padding-bottom: 0.05em; /* Ajuste fino */
    }

    .clock-icon-container .date2 { /* Metade inferior */
        top: 50%; /* Começa na metade */
        height: 50%; /* Ocupa metade inferior */
        background: var(--clock-inner-bg);
        border-radius: 0 0 5px 5px;
        align-items: flex-start; /* Alinha no topo da metade */
        padding-top: 0.05em; /* Ajuste fino */
        /* Efeito 3D sutil (opcional) */
        /* transform-origin: 50% 0%;
        transform: perspective(150px) rotateX(-5deg); */
    }
    /* --- Fim Estilos Novo Ícone --- */


    #weekly-calendar {
      display: flex;
      padding: 8px 4px;
      margin-bottom: 8px;
      border-bottom: 1px solid var(--input-border);
      overflow-x: auto; /* Habilita scroll/swipe */
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
      touch-action: pan-x; /* Prioriza swipe horizontal */
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      cursor: grab;
    }
    #weekly-calendar::-webkit-scrollbar { display: none; }
    #weekly-calendar:active { cursor: grabbing; }

    .week-day-item {
      display: flex; flex-direction: column; align-items: center;
      font-size: 0.75rem; color: var(--muted); padding: 4px 8px;
      border-radius: 8px; min-width: 48px; flex-shrink: 0;
      transition: background-color 0.3s ease, color 0.3s ease; text-align: center;
      position: relative; /* Para posicionar o SVG e o número */
      padding-top: 18px; /* Espaço para a letra do dia acima */
    }
    .week-day-item .day-name {
        position: absolute; /* Posiciona a letra acima */
        top: 2px; /* Espaçamento do topo */
        left: 50%;
        transform: translateX(-50%);
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.7rem; /* Tamanho menor para a letra */
        color: var(--muted); /* Cor padrão */
    }
    .week-day-item .day-number-container { /* Container para número e círculo */
        position: relative;
        width: 32px; /* Mesmo tamanho do SVG */
        height: 32px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .week-day-item .day-number {
        font-weight: 600;
        font-size: 0.9rem;
        z-index: 1; /* Acima do SVG */
        color: var(--text); /* Cor padrão do número */
    }
    .week-day-item.today .day-name { color: var(--accent); } /* Letra do dia atual */
    .week-day-item.today .day-number { color: var(--accent); } /* Número do dia atual */
    .week-day-item.today .weekly-progress-circle .progress-arc { stroke: var(--accent); } /* Círculo do dia atual */


    /* Estilos do Círculo de Progresso Semanal */
    .weekly-progress-circle {
        position: absolute;
        top: 0; /* Alinha com o topo do container do número */
        left: 0; /* Alinha com a esquerda do container do número */
        width: 100%; /* Ocupa todo o container */
        height: 100%;
        transform: rotate(-90deg); /* Rotaciona para começar do topo */
        z-index: 0; /* Atrás do número */
    }
    .weekly-progress-circle circle {
        fill: none;
        stroke-width: 3; /* Espessura da linha */
    }
    .weekly-progress-circle .bg-circle {
        stroke: var(--progress-circle-bg); /* Cor de fundo */
    }
    .weekly-progress-circle .progress-arc {
        stroke: var(--progress-circle-fg); /* Cor do progresso */
        stroke-linecap: round; /* Pontas arredondadas */
        stroke-dasharray: 0 100; /* Inicialmente vazio (perímetro aproximado) */
        transition: stroke-dasharray 0.5s ease;
    }


    nav {
      width: 100%; display: flex !important; flex-direction: row !important; gap: 8px !important;
      padding: 0 4px; margin-top: 8px; margin-bottom: 8px; overflow: visible !important;
      position: relative; z-index: 2100 !important;
    }
    nav::-webkit-scrollbar { display: none; }

    .day-btn {
      text-align: center; padding: 8px 16px; background: var(--day-btn-inactive-bg); /* Usa variável inativa */
      color: var(--day-btn-inactive-text); /* Usa variável inativa */
      border-radius: 12px !important;
      font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all .3s ease; white-space: nowrap;
      overflow: hidden; text-overflow: ellipsis; min-width: fit-content; height: 36px; display: flex;
      align-items: center; justify-content: center; pointer-events: all !important; z-index: 2200 !important;
      position: relative; border: none !important; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1) !important; /* Sombra mais sutil para inativos */
      flex: 1; flex-basis: 0; min-width: 0; transform: translateZ(0); -webkit-transform: translateZ(0); will-change: transform;
    }
    .day-btn:hover {
       background-color: color-mix(in srgb, var(--day-btn-inactive-bg) 85%, black); /* Escurece um pouco no hover */
       box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15) !important;
       transform: translateY(-1px) translateZ(0);
    }
    .day-btn.active {
        background: var(--accent);
        color: #fff;
        box-shadow: 0 4px 12px rgba(255, 0, 0, 0.2) !important;
    }
     .day-btn.active:hover { /* Mantém estilo ativo no hover */
        background: var(--accent);
        transform: translateY(-1px) translateZ(0);
        box-shadow: 0 6px 14px rgba(255, 0, 0, 0.25) !important;
    }


    @media screen and (max-width: 360px) {
      nav { gap: 4px !important; }
      .day-btn { padding: 8px 12px; font-size: 0.8rem; }
      #weekly-calendar { padding: 6px 2px; }
      .week-day-item { font-size: 0.7rem; min-width: 44px; padding: 4px 6px;}
      .week-day-item .day-number-container { width: 28px; height: 28px; }
      .week-day-item .day-number { font-size: 0.8rem; }
      .clock-icon-container { width: 50px; height: 50px; } /* Ajuste menor */
      .clock-icon-container .date { font-size: 1.8em; } /* Ajuste fonte menor */
      .weekly-progress-circle { width: 28px; height: 28px; } /* Círculo menor */
      .weekly-progress-circle circle { stroke-width: 2.5; }
    }

    .task {
      width: 100%; background: var(--card-bg); border-radius: 12px; display: flex; align-items: flex-start;
      padding: 16px 16px 16px 40px; margin: 12px 0; cursor: pointer; position: relative; color: var(--text);
      box-shadow: var(--shadow); transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .task.cardio-task { margin-top: 24px !important; margin-bottom: 24px !important; border-left: 4px solid var(--accent); border-right: 4px solid var(--accent); cursor: default; padding-left: 16px; }
    .task:first-child { margin-top: 0; }
    .task:last-child { margin-bottom: 0; }
    .task::before { content: "✓"; position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--check); font-size: 16px; font-weight: bold; opacity: 0; transition: opacity .3s ease; }
    .task.done { color: var(--muted); box-shadow: inset 0 2px 4px rgba(0,0,0,.1); background: var(--bg); }
    .task.done::before { opacity: 1; }
    .task.done .details { opacity: 0.5; }
    .task.slide-left { transform: translateX(-100px) scale(0.9); opacity: 0; z-index: 1; }
    @keyframes clean-task { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100%); opacity: 0; } }
    .task.cleaning { animation: clean-task 0.3s ease forwards; }

    .greeting { display: flex; flex-direction: column; width: calc(100% - 75px); /* Ajustado para novo tamanho do ícone */ flex-shrink: 0; }
    .greeting-title-row { display: flex; align-items: center; gap: 4px; font-size: 1.2rem; font-weight: 600; white-space: nowrap; }
    .greeting-title { font-size: 1.2rem; font-weight: 600; flex-shrink: 0; color: var(--text); }
    .greeting-subtitle { font-size: 0.9rem; color: var(--muted); }
    .aurora-word { position: relative; display: inline-block; font-size: 1.2rem; font-weight: 800; font-family: 'Inter', sans-serif; line-height: 1.2; color: var(--text); flex-shrink: 0; }

    /* Removido .circular-progress e seus estilos */

    .info { flex: 1; display: flex; flex-direction: column; gap: 4px; }
    .name { flex: 1; margin-bottom: 4px; font-weight: 600; }
    .details { font-size: .75rem; color: var(--muted); text-align: left; }

    .controls { display: flex; gap: 8px; align-items: center; height: 24px; z-index: 2050; pointer-events: auto; /* Habilitado para clicar */ margin: 0; padding: 0; }
    .controls > * { pointer-events: auto; }

    .button {
      --b: #275EFE; --b-h: #1D4FE1; display: flex; align-items: center; justify-content: center; gap: 1px;
      padding: 0 10px; border: 0; border-radius: 5px; font-size: 10px; font-weight: 600; background: var(--b);
      color: #fff; cursor: pointer; position: relative; margin: auto 0; min-width: 36px; height: 24px;
      overflow: hidden; contain: strict; pointer-events: auto; white-space: nowrap; transition: background-color 0.2s ease, transform 0.1s ease;
    }
    .button:hover { background: var(--b-h); }
    .button:active { transform: scale(.95); }
    .button .icon { width: 0px; height: 0px; position: relative; }
    .button .text span { display: inline-block; }
    #reset-btn {}
    #exit-btn { --b: #dc3545; --b-h: #c82333; }

    #content-spacer { display: none !important; }

    .tasks::-webkit-scrollbar { width: 4px; }
    .tasks::-webkit-scrollbar-track { background: transparent; }
    .tasks::-webkit-scrollbar-thumb { background-color: var(--muted); border-radius: 20px; border: 3px solid transparent; }

    /* Estilos do Modal do Calendário */
    #calendar-modal {
      display: none; position: fixed; z-index: 3000; left: 50%; top: 50%; transform: translate(-50%, -50%);
      width: 90%; max-width: 380px; background-color: var(--modal-bg); border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); padding: 20px; color: var(--text);
      border: 1px solid var(--modal-border); transition: opacity 0.3s ease, transform 0.3s ease;
    }
    #calendar-modal.visible { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }
    #calendar-modal:not(.visible) { opacity: 0; transform: translate(-50%, -50%) scale(0.95); pointer-events: none; }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .calendar-header h3 { margin: 0; font-size: 1.1rem; font-weight: 600; color: var(--calendar-header-text); }
    .calendar-nav button { background: none; border: none; font-size: 1.4rem; cursor: pointer; color: var(--muted); padding: 0 8px; }
    .calendar-nav button:hover { color: var(--accent); }
    #close-calendar-modal { font-size: 1.6rem; line-height: 1; color: var(--muted); }
    .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); margin-bottom: 10px; font-size: 0.7rem; font-weight: 600; text-align: center; color: var(--muted); text-transform: uppercase; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
    .calendar-day {
      display: flex; justify-content: center; align-items: center; height: 36px; font-size: 0.9rem;
      border-radius: 8px; background-color: var(--calendar-day-bg); color: var(--text);
      transition: background-color 0.2s ease; position: relative; cursor: pointer; /* Habilita cursor pointer */
    }
    .calendar-day.inactive { color: var(--calendar-inactive-day); background-color: transparent; cursor: default; } /* Inativo não é clicável */
    .calendar-day:not(.inactive):hover { background-color: var(--calendar-day-hover-bg); }
    .calendar-day.today { font-weight: bold; border: 1px solid var(--accent); }
    /* .calendar-day.completed { background-color: var(--calendar-day-completed-bg); color: var(--calendar-day-completed-text); font-weight: bold; } */
    .calendar-day .completed-dot { /* Estilo para o ponto de conclusão */
        position: absolute;
        bottom: 4px;
        left: 50%;
        transform: translateX(-50%);
        width: 6px;
        height: 6px;
        background-color: var(--completed-dot-color);
        border-radius: 50%;
        display: none; /* Escondido por padrão */
    }
    .calendar-day.has-activity .completed-dot { /* Mostra o ponto se houver atividade */
        display: block;
    }

    /* --- Estilos Dashboard --- */
    #dashboard {
        /* position: fixed; */ /* Removido */
        /* top: var(--header-height); */ /* Removido */
        /* left: 50%; */ /* Removido */
        /* transform: translateX(-50%); */ /* Removido */
        width: 100%;
        max-width: 400px; /* Mesma largura do header */
        padding: 16px;
        background-color: var(--dashboard-bg);
        border-radius: 16px; /* Bordas arredondadas */
        box-shadow: var(--shadow);
        /* z-index: 1900; */ /* Não mais necessário com position relative */
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        pointer-events: none;
        margin-top: 10px; /* Espaço entre header e dashboard */
    }
    #dashboard.visible {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
    }
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    .dashboard-header h3 {
        margin: 0;
        font-size: 1rem;
        font-weight: 600;
        color: var(--dashboard-text);
    }
    .dashboard-header .details-link { /* Estilo para o ícone de seta */
        font-size: 1.2rem;
        color: var(--dashboard-muted);
        text-decoration: none;
    }
    .dashboard-stats {
        display: flex;
        align-items: baseline;
        gap: 8px;
        margin-bottom: 15px;
    }
    .dashboard-stats .main-stat {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--dashboard-text);
    }
    .dashboard-stats .sub-stat {
        font-size: 0.8rem;
        color: var(--dashboard-muted);
        line-height: 1.2;
    }
    .dashboard-chart {
        display: flex;
        justify-content: space-around;
        align-items: flex-end; /* Alinha barras na base */
        height: 80px; /* Altura do gráfico */
        margin-bottom: 5px;
        padding: 0 5px; /* Pequeno padding lateral */
    }
    .chart-bar-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1; /* Distribui espaço */
        position: relative; /* Para o tooltip */
    }
    .chart-bar {
        width: 8px; /* Largura da barra */
        background-color: var(--dashboard-bar-bg);
        border-radius: 4px; /* Barras arredondadas */
        position: relative; /* Para o preenchimento */
        overflow: hidden; /* Esconde preenchimento que vaza */
        margin: 0 auto; /* Centraliza a barra */
    }
    .chart-bar .fill {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: var(--dashboard-bar-fill);
        border-radius: 4px;
        transition: height 0.5s ease-out;
    }
    .chart-tooltip {
        position: absolute;
        top: -25px; /* Acima da barra */
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(0,0,0,0.7);
        color: white;
        font-size: 0.7rem;
        padding: 3px 6px;
        border-radius: 4px;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.2s ease, visibility 0.2s ease;
    }
    .chart-bar-container:hover .chart-tooltip {
        opacity: 1;
        visibility: visible;
    }
    .dashboard-labels {
        display: flex;
        justify-content: space-around;
        font-size: 0.7rem;
        color: var(--dashboard-muted);
        padding: 0 5px;
    }
    .dashboard-labels span {
        flex: 1;
        text-align: center;
    }


    @media screen and (max-width: 400px) {
      .header-container { padding: 8px 12px !important; }
      .task { padding: 10px 12px 10px 36px; }
      .controls { gap: 6px; }
      .button { padding: 0 8px; font-size: 9px; }
      .theme-switch { height: 24px; margin-right: -4px; }
      .tgl + .tgl-btn { width: 38px; height: 22px; }
      .tgl + .tgl-btn:before { width: 18px; height: 18px; }
      .tgl:checked + .tgl-btn:before { transform: translate(16px, -50%); }
      #calendar-modal { width: 95%; padding: 15px; }
      .calendar-day { height: 32px; font-size: 0.8rem;}
      .calendar-header h3 { font-size: 1rem; }
      .clock-icon-container { width: 50px; height: 50px; } /* Ajuste menor */
      .clock-icon-container .date { font-size: 1.8em; } /* Ajuste fonte menor */
      #dashboard { padding: 12px; }
      .dashboard-stats .main-stat { font-size: 1.6rem; }
      .dashboard-chart { height: 60px; }
    }
    @media screen and (max-width: 480px) { .tasks { width: 100% !important; padding-left: 12px !important; padding-right: 12px !important; overflow-x: hidden; } }
    body:not(.dark-mode) .insights { box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12); }
    body:not(.dark-mode) .day-btn { box-shadow: 0 4px 16px rgba(0, 0, 0, 0.10); }
    body:not(.dark-mode) .day-btn:hover { box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15); }
    .screen.hidden, .page.hidden { display: none !important; }
    .screen.visible, .page.active { display: block !important; }

  </style>
</head>
<body>
  <section id="indexPage" class="page active">
    <div class="accents"> <div class="acc-card"></div> <div class="acc-card"></div> <div class="acc-card"></div> <div class="light"></div> <div class="light sm"></div> <div class="top-light"></div> </div>
    <div class="login"> <div class="theme-switch"> <input type="checkbox" id="theme-toggle" class="tgl"> <label for="theme-toggle" class="tgl-btn"></label> </div> <h1 style="text-align: center; width: 100%;">Claus Vision</h1> <p>Entrar aqui é iniciar uma nova forma de se acompanhar.</p> <form id="loginForm"> <input type="password" name="p" placeholder="Somente convidados" required> <button type="submit" class="btn">Entrar</button> </form> </div>
  </section>

  <section id="main-app" class="screen hidden">
    <div class="header-container">
      <header>
          <div style="flex-grow: 1;"></div> <div class="controls">
              <button id="reset-btn" class="button">Limpar</button>
              <button id="exit-btn" class="button">Sair</button>
              <div class="theme-switch">
                  <input type="checkbox" id="theme-toggle-exercise" class="tgl">
                  <label for="theme-toggle-exercise" class="tgl-btn"></label>
              </div>
          </div>
      </header>
      <section class="insights">
          <div class="greeting">
              <div class="greeting-title-row">
                  <span class="greeting-title">Oi,</span>
                  <span class="aurora-word">Claudius</span>
              </div>
              <div class="greeting-subtitle">Bom treino!</div>
          </div>
          <div class="clock-icon-container" id="clock-icon" title="Histórico de Treinos">
              <div class="outer">
                  <div class="handle"></div>
                  <div class="inner">
                      <span class="date date1" id="clock-date-top">5</span>
                      <div class="inner-shadow"></div>
                      <span class="date date2" id="clock-date-bottom">5</span>
                  </div>
              </div>
          </div>
      </section>
      <div id="weekly-calendar"></div>
      <nav id="nav-days"></nav>
    </div>

    <div id="dashboard">
        <div class="dashboard-header">
            <h3>Progresso</h3>
            <a href="#" class="details-link">↗</a> </div>
        <div class="dashboard-stats">
            <span class="main-stat">6.1h</span>
            <span class="sub-stat">Tempo Total<br>esta semana</span>
        </div>
        <div class="dashboard-chart">
            <div class="chart-bar-container">
                <div class="chart-bar" style="height: 30%;"><div class="fill" style="height: 100%;"></div></div>
                <div class="chart-tooltip">1.8h</div>
            </div>
            <div class="chart-bar-container">
                <div class="chart-bar" style="height: 70%;"><div class="fill" style="height: 100%;"></div></div>
                 <div class="chart-tooltip">4.2h</div>
            </div>
            <div class="chart-bar-container">
                <div class="chart-bar" style="height: 50%;"><div class="fill" style="height: 100%;"></div></div>
                 <div class="chart-tooltip">3.0h</div>
            </div>
            <div class="chart-bar-container">
                <div class="chart-bar" style="height: 40%;"><div class="fill" style="height: 100%;"></div></div>
                 <div class="chart-tooltip">2.4h</div>
            </div>
            <div class="chart-bar-container">
                <div class="chart-bar" style="height: 80%;"><div class="fill" style="height: 100%;"></div></div>
                 <div class="chart-tooltip">4.8h</div>
            </div>
             <div class="chart-bar-container">
                <div class="chart-bar" style="height: 90%; background-color: var(--dashboard-bar-fill);"><div class="fill" style="height: 100%; background-color: var(--dashboard-bar-fill);"></div></div> <div class="chart-tooltip" style="background-color: var(--dashboard-bar-fill); color: var(--text);">5h 23m</div>
            </div>
            <div class="chart-bar-container">
                <div class="chart-bar" style="height: 20%;"><div class="fill" style="height: 100%;"></div></div>
                 <div class="chart-tooltip">1.2h</div>
            </div>
        </div>
        <div class="dashboard-labels">
            <span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span>
        </div>
    </div>

    <section class="tasks" id="task-list"></section>

  </section> <div id="calendar-modal">
      <div class="calendar-header">
          <div class="calendar-nav"> <button id="prev-month">‹</button> </div>
          <h3 id="calendar-month-year">Maio 2025</h3>
          <div class="calendar-nav"> <button id="next-month">›</button> <button id="close-calendar-modal" style="margin-left: 10px;">×</button> </div>
      </div>
      <div class="calendar-weekdays"> <div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sáb</div><div>Dom</div> </div>
      <div class="calendar-grid" id="calendar-grid"> </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

  <script type="text/javascript">
    // Script de manipulação de arquivos (inalterado)
    var gk_isXlsx = false; var gk_xlsxFileLookup = {}; var gk_fileData = {}; function filledCell(cell) { return cell !== '' && cell != null; } function loadFileData(filename) { if (gk_isXlsx && gk_xlsxFileLookup[filename]) { try { var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' }); var firstSheetName = workbook.SheetNames[0]; var worksheet = workbook.Sheets[firstSheetName]; var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' }); var filteredData = jsonData.filter(row => row.some(filledCell)); var headerRowIndex = filteredData.findIndex((row, index) => row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length); if (headerRowIndex === -1 || headerRowIndex > 25) { headerRowIndex = 0; } var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); csv = XLSX.utils.sheet_to_csv(csv, { header: 1 }); return csv; } catch (e) { console.error(e); return ""; } } return gk_fileData[filename] || ""; }
  </script>

  <script>
    // --- Dados e Configurações Iniciais ---
    const USERS = { /* ... dados dos usuários inalterados ... */
        '123': { name: 'Claudius', type: 'weekly', tasks: { 'Segunda': [{ name:'Supino Reto Barra', sets:4, reps:'8-10', rest:'90s' },{ name:'Supino Inclinado Halteres', sets:3, reps:'10-12', rest:'60s' },{ name:'Crucifixo ou Crossover (drop)', sets:3, reps:'12-15', rest:'60s' },{ name:'Paralelas ou Supino Fechado', sets:3, reps:'10-12', rest:'60-90s' },{ name:'Extensão Tríceps Polia', sets:3, reps:'12-15', rest:'60s' },{ name:'Prancha (opcional)', sets:3, reps:'30-45s', rest:'30s' }], 'Terça': [{ name:'Barra fixa ou Pulldown', sets:4, reps:'6-10', rest:'90s' },{ name:'Remada Curvada Barra/Haltere', sets:3, reps:'8-10', rest:'90s' },{ name:'Remada Baixa Polia', sets:3, reps:'10-12', rest:'60s' },{ name:'Levant. Terra (opcional)', sets:3, reps:'8', rest:'120s' },{ name:'Rosca Direta Barra (drop)', sets:3, reps:'10-12', rest:'60s' },{ name:'Rosca Martelo Halteres', sets:3, reps:'12', rest:'60s' },{ name:'Rosca Concentrada/Scott', sets:2, reps:'15', rest:'45s' }], 'Quarta': [{ name:'Agachamento Livre', sets:4, reps:'8-10', rest:'120s' },{ name:'Leg Press 45°', sets:3, reps:'10-12', rest:'90s' },{ name:'Cadeira Extensora (drop)', sets:3, reps:'12-15', rest:'60s' },{ name:'Mesa Flexora', sets:3, reps:'10-12', rest:'60s' },{ name:'Stiff', sets:3, reps:'10', rest:'90s' },{ name:'Panturrilha em Pé', sets:4, reps:'15', rest:'60s' },{ name:'Abdômen', sets:3, reps:'15', rest:'30s' }], 'Quinta': [{ name:'Desenvolvimento Militar', sets:4, reps:'8-10', rest:'90s' },{ name:'Elevação Lateral', sets:3, reps:'12', rest:'60s' },{ name:'Elevação Frontal', sets:2, reps:'12-15', rest:'45s' },{ name:'Posterior de Ombro', sets:3, reps:'12-15', rest:'60s' },{ name:'Encolhimento', sets:3, reps:'12', rest:'60s' },{ name:'Abs: Crunch+Elevação', sets:3, reps:'15-20+15', rest:'30s' },{ name:'Prancha Lateral', sets:2, reps:'30s cada', rest:'30s' }], 'Sexta': [{ name:'Burpee com Flexão', sets:4, reps:'10', rest:'Sem pausa' },{ name:'Kettlebell Swing', sets:4, reps:'15', rest:'Sem pausa' },{ name:'Remada Curvada', sets:4, reps:'12', rest:'Sem pausa' },{ name:'Afundos', sets:4, reps:'10 cada', rest:'Sem pausa' },{ name:'Prancha', sets:4, reps:'30s', rest:'1-2 min' }] } },
        '456': { name: 'Matheus', type: 'groups', tasks: { 'Treino A': [{name:'Pulley frente aberto pronado',sets:5,reps:'20-15-12-10-10',rest:'60"'},{name:'Remada baixa fechada neutra',sets:4,reps:'10',rest:'60"'},{name:'Serrote com halteres',sets:3,reps:'8-8-8',rest:'90"'},{name:'Pulldown com corda no cross',sets:4,reps:'12-10-10-8',rest:'60"'},{name:'Rosca direta com barra W',sets:4,reps:'15-12-10-8',rest:'60"'},{name:'Rosca martelo unilateral com halteres',sets:3,reps:'12',rest:'60"'},{name:'Crucifixo inverso no voador',sets:5,reps:'20-15-12-10-8',rest:'60"'},{name:'Abdominal infra na paralela',sets:5,reps:'15',rest:'60"'}], 'Treino B': [{name:'Agachamento no smith',sets:4,reps:'15-12-10-8',rest:'90"'},{name:'Leg Press 45º',sets:4,reps:'12-10-8-8',rest:'60"'},{name:'Banco extensor',sets:4,reps:'12-10-8-8',rest:'60"'},{name:'Banco Adutor',sets:5,reps:'15-15-12-10-10',rest:'60"'},{name:'Panturrilha no Leg Horizontal',sets:5,reps:'15',rest:'60"'},{name:'Panturrilha em pé',sets:5,reps:'15',rest:'60"'}], 'Treino C': [{name:'Crucifixo no Cross Over',sets:4,reps:'15-12-12-10',rest:'60"'},{name:'Supino 30° no Smith (ou supino inclinado)',sets:4,reps:'10',rest:'60"'},{name:'Supino reto com halteres',sets:4,reps:'12-10-10-8',rest:'60"'},{name:'Supino canadense com barra',sets:5,reps:'15-12-10-8',rest:'60"'},{name:'Elevação lateral com halteres',sets:3,reps:'12',rest:'60"'},{name:'Desenvolvimento máquina',sets:3,reps:'15',rest:'60"'},{name:'Tríceps com corda',sets:4,reps:'15-12-10-8',rest:'60"'},{name:'Tríceps no Cross Over',sets:4,reps:'12-12-10-10',rest:'60"'},{name:'Abdominal infra na paralela',sets:5,reps:'15',rest:'60"'}], 'Treino D': [{name:'Cadeira flexora',sets:5,reps:'20-15-12-10-10',rest:'60"'},{name:'Mesa flexora',sets:4,reps:'12',rest:'60"'},{name:'Stiff com barra',sets:4,reps:'15-12-10-10',rest:'60"'},{name:'Elevação pélvica na máquina',sets:4,reps:'15-12-12-10',rest:'60"'},{name:'Banco abdutor',sets:4,reps:'12',rest:'60"'},{name:'Panturrilha em pé',sets:4,reps:'12',rest:'60"'},{name:'Panturrilha sentada',sets:5,reps:'15',rest:'60"'}] } }
    };
    const CARDIOS = { /* ... definições de cardio inalteradas ... */
        'Segunda': '🔥 HIIT na esteira (20 min pós-treino)', 'Terça': '🚴 Moderado contínuo (20 min pós-treino)', 'Quarta': '🚴 Moderado (leve, 20 min pós-treino)', 'Quinta': '🔥 HIIT bike/elíptico (20 min pós-treino)', 'Sexta': '✅ Incluído no circuito (não precisa adicional)', 'Treino A': '🏃 Cardio opcional (20 min)', 'Treino B': '🏃 Cardio opcional (20 min)', 'Treino C': '🏃 Cardio opcional (20 min)', 'Treino D': '🏃 Cardio opcional (20 min)'
    };
    const defaultUserId = '123';

    // --- Funções Utilitárias ---
    const safeGet=(k,d)=>{try{const item = localStorage.getItem(k); return item ? JSON.parse(item) : d;}catch{return d;}}
    const safeSet=(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch(e){console.error("Erro ao salvar:", e);}}
    const getISODate = (date = new Date()) => date.getFullYear() + '-' + ('0' + (date.getMonth() + 1)).slice(-2) + '-' + ('0' + date.getDate()).slice(-2);

    // --- Variáveis de Estado Globais ---
    let currentUserId = localStorage.getItem('currentUser') || defaultUserId;
    let currentUser = USERS[currentUserId] || USERS[defaultUserId];
    let data = safeGet(`workoutData_${currentUserId}`, JSON.parse(JSON.stringify(currentUser.tasks)));
    // Estrutura para progresso diário e histórico
    let dailyProgress = safeGet(`dailyProgress_${currentUserId}`, {}); // Ex: { "2025-05-05": { completedTasks: ["Task1", "Task2"], totalTasks: 6 }, ... }
    let currentDay = localStorage.getItem(`currentDay_${currentUserId}`) || (currentUser.type === 'groups' ? Object.keys(currentUser.tasks)[0] || 'Treino A' : 'Segunda');
    let isDark = localStorage.getItem('theme')==='dark';
    let calendarDate = new Date(); // Para calendário mensal
    let weeklyCalendarStartDate = getStartOfWeek(new Date(), 1); // Para calendário semanal interativo (1 = Segunda)

    // --- Elementos DOM ---
    const navEl=document.getElementById('nav-days'),
          listEl=document.getElementById('task-list'),
          tasksArea = document.querySelector('.tasks'),
          dashboardEl = document.getElementById('dashboard'), // NOVO: Referência ao dashboard
          toggleLogin=document.getElementById('theme-toggle'),
          toggleExercise=document.getElementById('theme-toggle-exercise'),
          resetBtn=document.getElementById('reset-btn'),
          exitBtn=document.getElementById('exit-btn'),
          headerContainerEl=document.querySelector('.header-container'),
          indexPage = document.getElementById('indexPage'),
          mainApp = document.getElementById('main-app'),
          insightsContainer = document.querySelector('.insights'),
          // REMOVIDO: currentDateEl = document.getElementById('current-date'),
          userNameEl = document.querySelector('.aurora-word'),
          weeklyCalendarEl = document.getElementById('weekly-calendar'),
          newCalendarIconContainer = document.getElementById('clock-icon'), // NOVO: ID para o container do ícone
          clockDateTop = document.getElementById('clock-date-top'), // NOVO: Span superior do ícone
          clockDateBottom = document.getElementById('clock-date-bottom'), // NOVO: Span inferior do ícone
          calendarModalEl = document.getElementById('calendar-modal'),
          calendarGridEl = document.getElementById('calendar-grid'),
          calendarMonthYearEl = document.getElementById('calendar-month-year'),
          prevMonthBtn = document.getElementById('prev-month'),
          nextMonthBtn = document.getElementById('next-month'),
          closeCalendarModalBtn = document.getElementById('close-calendar-modal');

    // --- Funções de Lógica e Renderização ---
    const saveState=()=>{
      safeSet(`workoutData_${currentUserId}`, data);
      safeSet(`dailyProgress_${currentUserId}`, dailyProgress); // Salva progresso diário
      localStorage.setItem(`currentDay_${currentUserId}`, currentDay);
      localStorage.setItem('theme',isDark?'dark':'light');
      // console.log("Estado salvo:", {currentUserId, currentDay, isDark, dailyProgress}); // Log opcional
    }

    function updateCurrentUser() {
        currentUserId = localStorage.getItem('currentUser') || defaultUserId;
        currentUser = USERS[currentUserId] || USERS[defaultUserId];
        data = safeGet(`workoutData_${currentUserId}`, JSON.parse(JSON.stringify(currentUser.tasks)));
        dailyProgress = safeGet(`dailyProgress_${currentUserId}`, {}); // Carrega progresso diário
        currentDay = localStorage.getItem(`currentDay_${currentUserId}`) || (currentUser.type === 'groups' ? Object.keys(currentUser.tasks)[0] || 'Treino A' : 'Segunda');
        // console.log("Usuário atualizado:", {currentUserId, currentDay, dailyProgress}); // Log opcional
    }

    // REMOVIDO: initCompletedGroups, calculateTotalProgress, setCircularProgress, renderProgress

    function getDays(user) {
      if (!user || !user.type) { console.error("Usuário inválido em getDays:", user); user = USERS[defaultUserId]; }
      if (user.type === 'weekly') { return [ { key: 'Segunda', label: 'SEGUNDA' }, { key: 'Terça', label: 'TERÇA' }, { key: 'Quarta', label: 'QUARTA' }, { key: 'Quinta', label: 'QUINTA' }, { key: 'Sexta', label: 'SEXTA' } ]; }
      else if (user.type === 'groups') { return Object.keys(user.tasks).map(key => ({ key: key, label: key.toUpperCase() })); }
      return [];
    }

    function getStartOfWeek(date, startDayIndex = 1) { // 0=Dom, 1=Seg
        const d = new Date(date);
        const day = d.getDay(); // 0 = Domingo, 1 = Segunda...
        const diff = d.getDate() - day + (day === 0 ? -6 : startDayIndex); // Ajusta para o dia de início desejado
        return new Date(d.setDate(diff));
    }

    function renderWeeklyCalendar(startDate = weeklyCalendarStartDate) {
        if (!weeklyCalendarEl) return;
        weeklyCalendarEl.innerHTML = '';
        const today = new Date();
        // Formatter para pegar a primeira letra do dia da semana
        const dayNameFormatter = new Intl.DateTimeFormat('pt-BR', { weekday: 'narrow' });
        const dayNumberFormatter = new Intl.DateTimeFormat('pt-BR', { day: 'numeric' });
        const radius = 14; // Raio do círculo SVG
        const circumference = 2 * Math.PI * radius; // Perímetro

        for (let i = 0; i < 7; i++) {
            const day = new Date(startDate);
            day.setDate(startDate.getDate() + i);
            const dayISO = getISODate(day); // Data no formato<x_bin_880>-MM-DD

            const dayItem = document.createElement('div');
            dayItem.className = 'week-day-item';
            if (day.toDateString() === today.toDateString()) {
                dayItem.classList.add('today');
            }

            // --- Letra do Dia (Acima) ---
            const dayName = document.createElement('span');
            dayName.className = 'day-name';
            // Pega a primeira letra (narrow) e capitaliza
            dayName.textContent = dayNameFormatter.format(day).toUpperCase();
            dayItem.appendChild(dayName);

            // --- Container para Círculo e Número ---
            const dayNumberContainer = document.createElement('div');
            dayNumberContainer.className = 'day-number-container';

            // --- SVG do Círculo de Progresso ---
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("class", "weekly-progress-circle");
            svg.setAttribute("viewBox", "0 0 32 32"); // ViewBox ajustado para o raio

            const bgCircle = document.createElementNS(svgNS, "circle");
            bgCircle.setAttribute("class", "bg-circle");
            bgCircle.setAttribute("cx", "16");
            bgCircle.setAttribute("cy", "16");
            bgCircle.setAttribute("r", radius);

            const progressArc = document.createElementNS(svgNS, "circle");
            progressArc.setAttribute("class", "progress-arc");
            progressArc.setAttribute("cx", "16");
            progressArc.setAttribute("cy", "16");
            progressArc.setAttribute("r", radius);

            // Calcula o progresso para esta data
            let progressPercent = 0;
            const progressData = dailyProgress[dayISO];
            if (progressData && progressData.totalTasks > 0) {
                // Usa completedTasks.length se existir, senão usa 0
                const completedCount = progressData.completedTasks ? progressData.completedTasks.length : 0;
                progressPercent = (completedCount / progressData.totalTasks);
            }
            // Garante que o progresso seja entre 0 e 1
            progressPercent = Math.max(0, Math.min(1, progressPercent));
            const dashOffset = circumference * (1 - progressPercent);
            // Define o stroke-dasharray e stroke-dashoffset para animar o preenchimento
            progressArc.style.strokeDasharray = `${circumference} ${circumference}`;
            progressArc.style.strokeDashoffset = dashOffset;


            svg.appendChild(bgCircle);
            svg.appendChild(progressArc);
            dayNumberContainer.appendChild(svg); // Adiciona SVG ao container

            // --- Número do Dia (Dentro) ---
            const dayNumber = document.createElement('span');
            dayNumber.className = 'day-number';
            dayNumber.textContent = dayNumberFormatter.format(day);
            dayNumberContainer.appendChild(dayNumber); // Adiciona número ao container

            dayItem.appendChild(dayNumberContainer); // Adiciona container ao item do dia
            weeklyCalendarEl.appendChild(dayItem);
        }
    }


    function renderNav() {
      if (!navEl) return;
      navEl.innerHTML = '';
      const userDays = getDays(currentUser);
      userDays.forEach(d => {
        const btn = document.createElement('div');
        btn.className = `day-btn${d.key === currentDay ? ' active' : ''}`;
        btn.textContent = d.label;
        btn.setAttribute('data-day', d.key);
        const handleClick = (e) => {
          e.stopPropagation();
          const targetDay = btn.getAttribute('data-day');
          if (targetDay === currentDay) { toggleTasksList(); return; }
          // console.log(`Botão ${targetDay} clicado/tocado`); // Log opcional
          document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentDay = targetDay;
          saveState();
          renderTasks();
          // REMOVIDO: renderProgress();
          if (tasksArea && !tasksArea.classList.contains('visible')) { tasksArea.classList.add('visible'); }
           if (dashboardEl) dashboardEl.classList.remove('visible'); // Esconde dashboard ao trocar de dia
        };
        btn.addEventListener('click', handleClick);
        btn.addEventListener('touchend', handleClick, { passive: true });
        navEl.appendChild(btn);
      });
    }

    function renderTasks() {
      if (!listEl) { console.error("#task-list não encontrado"); return; }
      listEl.innerHTML = '';
      let tasks = data[currentDay] || [];
      // console.log("Renderizando tarefas para:", currentDay, "Total:", tasks.length); // Log opcional

      const tasksWrapper = document.createElement('div');
      tasksWrapper.className = 'tasks-wrapper';
      listEl.appendChild(tasksWrapper);

      if (tasks.length === 0 && currentUser && currentUser.tasks && currentUser.tasks[currentDay]) {
        // console.log(`Recarregando tarefas para ${currentDay}`); // Log opcional
        data[currentDay] = JSON.parse(JSON.stringify(currentUser.tasks[currentDay]));
        tasks = data[currentDay];
        // Não salva aqui, pois só recarregou para exibição
      }

      tasks.forEach((t, index) => {
        const task = document.createElement('div');
        task.className = `task${t.done ? ' done' : ''}`;
        task.setAttribute('data-index', index);
        task.innerHTML = `<div class="info"><div class="name">${t.name}</div><div class="details">${t.sets}× · ${t.reps} · descanso ${t.rest}</div></div>`;
        tasksWrapper.appendChild(task);

        task.onclick = function() {
          const taskIndex = parseInt(this.getAttribute('data-index'));
          if (isNaN(taskIndex) || taskIndex < 0 || taskIndex >= data[currentDay].length) { console.error("Índice de tarefa inválido:", taskIndex); return; }

          const currentTaskData = data[currentDay][taskIndex];
          const taskName = currentTaskData.name; // Guarda o nome da tarefa
          currentTaskData.done = !currentTaskData.done; // Alterna o estado

          // --- Atualiza Progresso Diário ---
          const todayISO = getISODate(); // Usa a data atual para registrar o progresso
          const totalTasksInPlan = currentUser.tasks[currentDay]?.length || 0; // Total de tarefas planejadas para este tipo de dia

          // Inicializa a entrada do dia se não existir
          if (!dailyProgress[todayISO]) {
              dailyProgress[todayISO] = { completedTasks: [], totalTasks: totalTasksInPlan };
          }
          // Garante que totalTasks esteja correto caso o plano mude
          dailyProgress[todayISO].totalTasks = totalTasksInPlan;

          // Atualiza a lista de tarefas concluídas para a data
          if (currentTaskData.done) {
              // Adiciona se não estiver presente
              if (!dailyProgress[todayISO].completedTasks.includes(taskName)) {
                  dailyProgress[todayISO].completedTasks.push(taskName);
              }
          } else {
              // Remove se estiver presente
              dailyProgress[todayISO].completedTasks = dailyProgress[todayISO].completedTasks.filter(name => name !== taskName);
          }

          // Se não houver mais tarefas concluídas neste dia, remove a entrada
          if (dailyProgress[todayISO].completedTasks.length === 0) {
              delete dailyProgress[todayISO];
              console.log(`Entrada de progresso removida para ${todayISO}`);
          } else {
              console.log(`Progresso atualizado para ${todayISO}: ${dailyProgress[todayISO].completedTasks.length}/${dailyProgress[todayISO].totalTasks} tarefas concluídas.`);
              // console.log("Tarefas concluídas:", dailyProgress[todayISO].completedTasks); // Log opcional
          }


          // --- Lógica de Animação e Re-renderização ---
          if (currentTaskData.done) {
            this.classList.add('slide-left');
            setTimeout(() => {
              // Reorganiza o array de dados para mover a tarefa concluída para o final
              const completedTask = data[currentDay].splice(taskIndex, 1)[0];
              data[currentDay].push(completedTask);
              saveState(); // Salva o estado atualizado (incluindo dailyProgress e nova ordem)
              render(); // Re-renderiza tudo (incluindo calendário semanal e lista de tarefas)
            }, 500);
          } else {
            // Se desmarcou, move de volta para a posição original (aproximada) ou início
            const incompleteTask = data[currentDay].splice(taskIndex, 1)[0];
            const originalIndex = currentUser.tasks[currentDay].findIndex(origTask => origTask.name === incompleteTask.name);
            data[currentDay].splice(originalIndex !== -1 ? originalIndex : 0, 0, incompleteTask);
             saveState();
             render();
          }
        };
      });

      const cardioDescription = CARDIOS[currentDay];
      if (cardioDescription) {
          const cardioTask = document.createElement('div'); cardioTask.className = 'task cardio-task'; cardioTask.style.cssText = 'border-left: 4px solid var(--accent); border-right: 4px solid var(--accent); margin-top: 20px; padding-left: 16px; cursor: default;'; cardioTask.innerHTML = `<div class="info"><div class="name" style="font-weight: 600;">Cardio</div><div class="cardio-desc" style="font-size: 0.9rem; color: var(--muted);">${cardioDescription}</div></div>`; tasksWrapper.appendChild(cardioTask);
      }

      const spacer = document.createElement('div');
      spacer.style.height = '80px';
      listEl.appendChild(spacer);
    }

    function updateLayout() {
      if (headerContainerEl) {
        requestAnimationFrame(() => {
            const height = headerContainerEl.getBoundingClientRect().height;
            document.documentElement.style.setProperty('--header-height', `${height}px`);
             // Atualiza posição do dashboard e tasks (agora absoluta)
            const contentTopPosition = height + parseFloat(getComputedStyle(headerContainerEl).top) + 10; // Altura + Espaço do Topo + Margem
            if(dashboardEl) {
                 dashboardEl.style.top = `${contentTopPosition}px`;
            }
            if(tasksArea) {
                tasksArea.style.top = `${contentTopPosition}px`;
            }
        });
      }
    }

    function renderMonthlyCalendar() {
        if (!calendarGridEl || !calendarMonthYearEl) return;
        const year = calendarDate.getFullYear();
        const month = calendarDate.getMonth();
        const today = new Date();
        const todayISO = getISODate(today);

        calendarMonthYearEl.textContent = calendarDate.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
        calendarGridEl.innerHTML = '';

        const firstDayOfMonth = new Date(year, month, 1);
        const lastDayOfMonth = new Date(year, month + 1, 0);
        const daysInMonth = lastDayOfMonth.getDate();
        let startDayOfWeek = firstDayOfMonth.getDay();
        startDayOfWeek = startDayOfWeek === 0 ? 6 : startDayOfWeek - 1; // Ajusta para Segunda=0

        for (let i = 0; i < startDayOfWeek; i++) { const emptyCell = document.createElement('div'); emptyCell.className = 'calendar-day inactive'; calendarGridEl.appendChild(emptyCell); }
        for (let day = 1; day <= daysInMonth; day++) {
            const cell = document.createElement('div'); cell.className = 'calendar-day'; cell.textContent = day;
            const currentDate = new Date(year, month, day);
            const currentDateISO = getISODate(currentDate);
            cell.setAttribute('data-date', currentDateISO); // Armazena a data no elemento

            if (currentDateISO === todayISO) { cell.classList.add('today'); }

            // Verifica se houve *alguma* atividade neste dia para adicionar o ponto e o listener
            const progressData = dailyProgress[currentDateISO];
            if (progressData && progressData.completedTasks && progressData.completedTasks.length > 0) {
                cell.classList.add('has-activity'); // Adiciona classe para o ponto
                const dot = document.createElement('span');
                dot.className = 'completed-dot';
                cell.appendChild(dot); // Adiciona o ponto ao dia

                // Adiciona listener de clique APENAS se houver atividade
                cell.addEventListener('click', () => showDailyHistory(currentDateISO));
                cell.addEventListener('touchend', (e) => {
                    e.preventDefault(); // Previne clique duplo em touch
                    showDailyHistory(currentDateISO);
                }, { passive: false });

            } else {
                 cell.style.cursor = 'default'; // Remove cursor pointer se não houver atividade
            }
            calendarGridEl.appendChild(cell);
        }
        const totalCells = startDayOfWeek + daysInMonth; const remainingCells = (7 - (totalCells % 7)) % 7;
        for (let i = 0; i < remainingCells; i++) { const emptyCell = document.createElement('div'); emptyCell.className = 'calendar-day inactive'; calendarGridEl.appendChild(emptyCell); }
    }

    // NOVO: Função para mostrar histórico
    function showDailyHistory(dateISO) {
        const progressData = dailyProgress[dateISO];
        if (progressData && progressData.completedTasks && progressData.completedTasks.length > 0) {
            const dateFormatted = new Date(dateISO + 'T00:00:00').toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit', year: 'numeric'});
            const historyText = `Exercícios concluídos em ${dateFormatted}:\n- ${progressData.completedTasks.join('\n- ')}`;
            alert(historyText); // Exibe em um alerta simples
        } else {
            // Opcional: Mostrar mensagem se não houver histórico (embora o clique só seja adicionado se houver)
            // alert(`Nenhum exercício concluído em ${dateISO}.`);
            console.log(`Tentativa de ver histórico para ${dateISO}, mas não há dados.`);
        }
    }

    // NOVO: Função para renderizar o dashboard (com dados placeholder)
    function renderDashboard() {
        if (!dashboardEl) return;
        // Lógica para calcular dados reais iria aqui (ex: tempo total, barras do gráfico)
        // Por enquanto, apenas garante que está visível/oculto corretamente
        // A visibilidade é controlada por toggleTasksList
    }

    function render() {
      // console.log("Renderizando UI para:", currentDay); // Log opcional
      if (userNameEl) { userNameEl.textContent = currentUser.name; }
      document.body.setAttribute('data-treino', currentDay);

      renderNav();
      // REMOVIDO: renderProgress();
      renderWeeklyCalendar(); // Renderiza calendário semanal com a data atual (weeklyCalendarStartDate)
      updateLayout(); // Calcula altura do header ANTES de renderizar tarefas e dashboard
      renderTasks();
      renderDashboard(); // Renderiza (ou atualiza) o dashboard

      // Atualiza número no ícone do calendário flip clock
      const currentDayOfMonth = new Date().getDate();
      if(clockDateTop) { clockDateTop.textContent = currentDayOfMonth; }
      if(clockDateBottom) { clockDateBottom.textContent = currentDayOfMonth; }
    }

    function toggleTasksList() {
      if (tasksArea && dashboardEl) {
        const isTasksVisible = tasksArea.classList.toggle('visible');
        dashboardEl.classList.toggle('visible', !isTasksVisible); // Mostra dashboard se tasks NÃO estiver visível
        console.log("Visibilidade alternada. Tasks visível:", isTasksVisible, "Dashboard visível:", !isTasksVisible);
      }
    }

    // --- Event Handlers ---
    function handleLogin(event) {
        event.preventDefault();
        const passwordInput = loginForm.querySelector('input[name="p"]');
        const password = passwordInput.value;
        const user = USERS[password];
        if (user) {
          localStorage.setItem('currentUser', password); updateCurrentUser();
          if (userNameEl) userNameEl.textContent = currentUser.name;
          indexPage.classList.remove('active'); indexPage.classList.add('hidden');
          mainApp.classList.remove('hidden'); mainApp.classList.add('visible');
          weeklyCalendarStartDate = getStartOfWeek(new Date(), 1); // Reseta calendário semanal para semana atual (iniciando Segunda)
          saveState(); render();
          // Garante que tasks esteja escondido e dashboard visível inicialmente após login
          if (tasksArea) tasksArea.classList.remove('visible');
          if (dashboardEl) dashboardEl.classList.add('visible');
          passwordInput.value = '';
        } else {
          alert('Senha incorreta! Tente novamente.'); passwordInput.value = ''; passwordInput.focus();
        }
    }

    function handleReset(e) {
        e.stopPropagation();
        // console.log('Botão Limpar clicado/tocado'); // Log opcional
        if (resetBtn.classList.contains('delete')) return;
        resetBtn.classList.add('delete');
        const taskElements = listEl.querySelectorAll('.task:not(.cardio-task)');
        taskElements.forEach((task, index) => { setTimeout(() => { task.classList.add('cleaning'); }, index * 40); });
        setTimeout(() => {
            listEl.innerHTML = '';
            if (tasksArea) tasksArea.classList.remove('visible'); // Esconde tasks
            if (dashboardEl) dashboardEl.classList.add('visible'); // Mostra dashboard
            data = JSON.parse(JSON.stringify(currentUser.tasks));
            dailyProgress = {}; // Limpa progresso diário
            currentDay = currentUser.type === 'groups' ? getDays(currentUser)[0]?.key || 'Treino A' : 'Segunda';
            weeklyCalendarStartDate = getStartOfWeek(new Date(), 1); // Reseta calendário semanal (iniciando Segunda)
            saveState(); render(); resetBtn.classList.remove('delete');
        }, (taskElements.length * 40) + 300);
    }

    function handleExit(e) {
        e.stopPropagation();
        // console.log('Botão Sair clicado/tocado'); // Log opcional
        if (mainApp) { mainApp.classList.remove('visible'); mainApp.classList.add('hidden'); }
        if (indexPage) { indexPage.classList.remove('hidden'); indexPage.classList.add('active'); }
        const passwordInput = document.querySelector('#loginForm input[name="p"]');
        if (passwordInput) { passwordInput.value = ''; }
        if (tasksArea) tasksArea.classList.remove('visible');
        if (dashboardEl) dashboardEl.classList.remove('visible'); // Esconde dashboard ao sair
    }

    function handleInsightClick(e) {
        // Verifica se o clique foi no container do ícone ou em seus filhos
        if (newCalendarIconContainer && newCalendarIconContainer.contains(e.target)) {
             return; // Deixa o handler do ícone cuidar disso
        }
        toggleTasksList(); // Alterna a lista se clicou fora do ícone
    }

    function openCalendarModal() {
        if (!calendarModalEl) return;
        calendarDate = new Date();
        renderMonthlyCalendar();
        calendarModalEl.classList.add('visible');
    }

    function closeCalendarModal() {
        if (!calendarModalEl) return;
        calendarModalEl.classList.remove('visible');
    }

    function changeMonth(offset) {
        calendarDate.setMonth(calendarDate.getMonth() + offset);
        renderMonthlyCalendar();
    }

    function setupThemeToggle(toggleElement) {
        if (!toggleElement) return;
        const toggleHandler = () => {
            isDark = toggleElement.checked; document.body.classList.toggle('dark-mode', isDark);
            if (toggleLogin && toggleLogin !== toggleElement) toggleLogin.checked = isDark;
            if (toggleExercise && toggleExercise !== toggleElement) toggleExercise.checked = isDark;
            saveState();
        };
        toggleElement.addEventListener('change', toggleHandler);
        const label = document.querySelector(`label[for='${toggleElement.id}']`);
        if (label) { label.addEventListener('touchend', (e) => { e.preventDefault(); e.stopPropagation(); toggleElement.checked = !toggleElement.checked; toggleHandler(); }, { passive: false }); }
    }

    // --- Interação Calendário Semanal ---
    let touchStartX = 0;
    let isDragging = false;
    const swipeThreshold = 50; // Sensibilidade do swipe

    function handleTouchStart(e) {
        // Verifica se o toque começou dentro do elemento #weekly-calendar
        if (weeklyCalendarEl.contains(e.target)) {
            touchStartX = e.touches[0].clientX;
            isDragging = false; // Reseta a flag de arrastar
            weeklyCalendarEl.style.cursor = 'grabbing'; // Muda o cursor
            // console.log('Weekly Touch Start:', touchStartX); // Debug
        } else {
            touchStartX = 0; // Ignora toques fora do elemento
        }
    }

    function handleTouchMove(e) {
        if (!touchStartX) return; // Só continua se o toque começou no elemento certo
        const currentX = e.touches[0].clientX;
        const deltaX = currentX - touchStartX;
        // Define isDragging como true se o movimento horizontal for maior que um pequeno threshold
        if (Math.abs(deltaX) > 10 && !isDragging) {
             isDragging = true;
             // console.log('Dragging started'); // Debug
             // Previne o scroll vertical da página APENAS se o swipe horizontal começar
             // Isso evita que a página role para cima/baixo enquanto tenta fazer swipe lateral
             if (e.cancelable) e.preventDefault();
        }
    }

    function handleTouchEnd(e) {
        weeklyCalendarEl.style.cursor = 'grab'; // Restaura o cursor
        if (!touchStartX || !isDragging) { // Só processa o swipe se estava arrastando
            touchStartX = 0;
            isDragging = false;
            return;
        }
        const touchEndX = e.changedTouches[0].clientX;
        const deltaX = touchEndX - touchStartX;
        // console.log('Weekly Touch End - DeltaX:', deltaX); // Debug

        if (Math.abs(deltaX) > swipeThreshold) {
            if (deltaX < 0) { // Swipe para a Esquerda (próxima semana)
                weeklyCalendarStartDate.setDate(weeklyCalendarStartDate.getDate() + 7);
            } else { // Swipe para a Direita (semana anterior)
                weeklyCalendarStartDate.setDate(weeklyCalendarStartDate.getDate() - 7);
            }
            renderWeeklyCalendar(); // Re-renderiza o calendário
        }
        // Reseta as variáveis
        touchStartX = 0;
        isDragging = false;
    }


    // --- Adicionando Event Listeners ---
    document.addEventListener('DOMContentLoaded', () => {
        const loginForm = document.getElementById('loginForm');
        if (loginForm) { loginForm.addEventListener('submit', handleLogin); }
        else { console.error("Formulário de login não encontrado"); }

        if (resetBtn) { resetBtn.addEventListener('click', handleReset); resetBtn.addEventListener('touchstart', (e) => { e.preventDefault(); e.stopPropagation(); handleReset(e); }, { passive: false }); }
        if (exitBtn) { exitBtn.addEventListener('click', handleExit); exitBtn.addEventListener('touchstart', (e) => { e.preventDefault(); e.stopPropagation(); handleExit(e); }, { passive: false }); }
        if (insightsContainer) { insightsContainer.addEventListener('click', handleInsightClick); /* touchend tratado abaixo */ }

        // Listener para o NOVO container do ícone
        if (newCalendarIconContainer) {
            newCalendarIconContainer.addEventListener('click', (e) => { e.stopPropagation(); openCalendarModal(); });
            newCalendarIconContainer.addEventListener('touchend', (e) => { e.preventDefault(); e.stopPropagation(); openCalendarModal(); }, { passive: false });
        } else { console.error("Container do novo ícone de calendário não encontrado"); }

        if (insightsContainer) {
             insightsContainer.addEventListener('touchend', (e) => {
                 // Verifica se o toque NÃO foi no container do ícone
                 if (newCalendarIconContainer && !newCalendarIconContainer.contains(e.target)) {
                     e.preventDefault(); e.stopPropagation(); handleInsightClick(e);
                 }
             }, { passive: false });
        }

        if (closeCalendarModalBtn) { closeCalendarModalBtn.addEventListener('click', closeCalendarModal); closeCalendarModalBtn.addEventListener('touchend', (e) => { e.preventDefault(); e.stopPropagation(); closeCalendarModal(); }, { passive: false }); }
        if (prevMonthBtn) { prevMonthBtn.addEventListener('click', () => changeMonth(-1)); prevMonthBtn.addEventListener('touchend', (e) => { e.preventDefault(); e.stopPropagation(); changeMonth(-1); }, { passive: false }); }
        if (nextMonthBtn) { nextMonthBtn.addEventListener('click', () => changeMonth(1)); nextMonthBtn.addEventListener('touchend', (e) => { e.preventDefault(); e.stopPropagation(); changeMonth(1); }, { passive: false }); }

        // Listeners de Swipe no Calendário Semanal (touchstart, touchmove, touchend)
        if (weeklyCalendarEl) {
            // Usando {passive: false} no touchmove para poder chamar preventDefault()
            weeklyCalendarEl.addEventListener('touchstart', handleTouchStart, { passive: true }); // passive: true é ok aqui
            weeklyCalendarEl.addEventListener('touchmove', handleTouchMove, { passive: false }); // passive: false para permitir preventDefault
            weeklyCalendarEl.addEventListener('touchend', handleTouchEnd, { passive: true }); // passive: true é ok aqui
        } else { console.error("Elemento do calendário semanal não encontrado"); }

        setupThemeToggle(toggleLogin);
        setupThemeToggle(toggleExercise);

        if (localStorage.getItem('currentUser')) {
             updateCurrentUser();
             mainApp.classList.remove('hidden'); mainApp.classList.add('visible');
             indexPage.classList.remove('active'); indexPage.classList.add('hidden');
             weeklyCalendarStartDate = getStartOfWeek(new Date(), 1); // Define data inicial (Segunda)
             render();
             // Garante estado inicial correto de visibilidade
             if (tasksArea) tasksArea.classList.remove('visible');
             if (dashboardEl) dashboardEl.classList.add('visible');

             isDark = localStorage.getItem('theme') === 'dark'; document.body.classList.toggle('dark-mode', isDark);
             if(toggleLogin) toggleLogin.checked = isDark; if(toggleExercise) toggleExercise.checked = isDark;
        } else {
             indexPage.classList.add('active'); indexPage.classList.remove('hidden');
             mainApp.classList.add('hidden'); mainApp.classList.remove('visible');
             isDark = localStorage.getItem('theme') === 'dark'; document.body.classList.toggle('dark-mode', isDark);
             if(toggleLogin) toggleLogin.checked = isDark;
        }
    });

    window.addEventListener('resize', updateLayout);

  </script>

  <script> (function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93a3d13baaba1d72',t:'MTc0NjMxNzg2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})(); </script>
  <script> (function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93aa9c0d4d964535',t:'MTc0NjM4OTA5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})(); </script>

</body>
</html>
